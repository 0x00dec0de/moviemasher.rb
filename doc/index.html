<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body>
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="./README_md.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./MovieMasher.html">MovieMasher</a>
  
    <li><a href="./MovieMasher/AV.html">MovieMasher::AV</a>
  
    <li><a href="./MovieMasher/Callback.html">MovieMasher::Callback</a>
  
    <li><a href="./MovieMasher/Chain.html">MovieMasher::Chain</a>
  
    <li><a href="./MovieMasher/ChainEffects.html">MovieMasher::ChainEffects</a>
  
    <li><a href="./MovieMasher/ChainModule.html">MovieMasher::ChainModule</a>
  
    <li><a href="./MovieMasher/ChainOverlay.html">MovieMasher::ChainOverlay</a>
  
    <li><a href="./MovieMasher/ChainScaler.html">MovieMasher::ChainScaler</a>
  
    <li><a href="./MovieMasher/Defaults.html">MovieMasher::Defaults</a>
  
    <li><a href="./MovieMasher/Error.html">MovieMasher::Error</a>
  
    <li><a href="./MovieMasher/Error/Configuration.html">MovieMasher::Error::Configuration</a>
  
    <li><a href="./MovieMasher/Error/Critical.html">MovieMasher::Error::Critical</a>
  
    <li><a href="./MovieMasher/Error/Job.html">MovieMasher::Error::Job</a>
  
    <li><a href="./MovieMasher/Error/JobInput.html">MovieMasher::Error::JobInput</a>
  
    <li><a href="./MovieMasher/Error/JobOutput.html">MovieMasher::Error::JobOutput</a>
  
    <li><a href="./MovieMasher/Error/JobRender.html">MovieMasher::Error::JobRender</a>
  
    <li><a href="./MovieMasher/Error/JobSource.html">MovieMasher::Error::JobSource</a>
  
    <li><a href="./MovieMasher/Error/JobUpload.html">MovieMasher::Error::JobUpload</a>
  
    <li><a href="./MovieMasher/Error/Object.html">MovieMasher::Error::Object</a>
  
    <li><a href="./MovieMasher/Error/Parameter.html">MovieMasher::Error::Parameter</a>
  
    <li><a href="./MovieMasher/Error/Runtime.html">MovieMasher::Error::Runtime</a>
  
    <li><a href="./MovieMasher/Error/State.html">MovieMasher::Error::State</a>
  
    <li><a href="./MovieMasher/Error/Todo.html">MovieMasher::Error::Todo</a>
  
    <li><a href="./MovieMasher/Evaluate.html">MovieMasher::Evaluate</a>
  
    <li><a href="./MovieMasher/Fill.html">MovieMasher::Fill</a>
  
    <li><a href="./MovieMasher/Filter.html">MovieMasher::Filter</a>
  
    <li><a href="./MovieMasher/FilterEvaluated.html">MovieMasher::FilterEvaluated</a>
  
    <li><a href="./MovieMasher/FilterHash.html">MovieMasher::FilterHash</a>
  
    <li><a href="./MovieMasher/FilterHelpers.html">MovieMasher::FilterHelpers</a>
  
    <li><a href="./MovieMasher/FilterSetpts.html">MovieMasher::FilterSetpts</a>
  
    <li><a href="./MovieMasher/FilterSource.html">MovieMasher::FilterSource</a>
  
    <li><a href="./MovieMasher/FilterSourceColor.html">MovieMasher::FilterSourceColor</a>
  
    <li><a href="./MovieMasher/FilterSourceMovie.html">MovieMasher::FilterSourceMovie</a>
  
    <li><a href="./MovieMasher/FloatUtil.html">MovieMasher::FloatUtil</a>
  
    <li><a href="./MovieMasher/Gain.html">MovieMasher::Gain</a>
  
    <li><a href="./MovieMasher/Graph.html">MovieMasher::Graph</a>
  
    <li><a href="./MovieMasher/GraphMash.html">MovieMasher::GraphMash</a>
  
    <li><a href="./MovieMasher/GraphRaw.html">MovieMasher::GraphRaw</a>
  
    <li><a href="./MovieMasher/Info.html">MovieMasher::Info</a>
  
    <li><a href="./MovieMasher/Input.html">MovieMasher::Input</a>
  
    <li><a href="./MovieMasher/Intermediate.html">MovieMasher::Intermediate</a>
  
    <li><a href="./MovieMasher/Job.html">MovieMasher::Job</a>
  
    <li><a href="./MovieMasher/JobHash.html">MovieMasher::JobHash</a>
  
    <li><a href="./MovieMasher/Layer.html">MovieMasher::Layer</a>
  
    <li><a href="./MovieMasher/LayerColor.html">MovieMasher::LayerColor</a>
  
    <li><a href="./MovieMasher/LayerModule.html">MovieMasher::LayerModule</a>
  
    <li><a href="./MovieMasher/LayerRaw.html">MovieMasher::LayerRaw</a>
  
    <li><a href="./MovieMasher/LayerRawImage.html">MovieMasher::LayerRawImage</a>
  
    <li><a href="./MovieMasher/LayerRawVideo.html">MovieMasher::LayerRawVideo</a>
  
    <li><a href="./MovieMasher/LayerTheme.html">MovieMasher::LayerTheme</a>
  
    <li><a href="./MovieMasher/LayerTransition.html">MovieMasher::LayerTransition</a>
  
    <li><a href="./MovieMasher/Mash.html">MovieMasher::Mash</a>
  
    <li><a href="./MovieMasher/Method.html">MovieMasher::Method</a>
  
    <li><a href="./MovieMasher/Output.html">MovieMasher::Output</a>
  
    <li><a href="./MovieMasher/Path.html">MovieMasher::Path</a>
  
    <li><a href="./MovieMasher/Source.html">MovieMasher::Source</a>
  
    <li><a href="./MovieMasher/TimeRange.html">MovieMasher::TimeRange</a>
  
    <li><a href="./MovieMasher/Transfer.html">MovieMasher::Transfer</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation" class="description">

<p><img
src="https://github.com/moviemasher/angular-moviemasher/raw/master/README/logo-120x60.png"
/>
<strong><a
href="https://github.com/moviemasher/moviemasher.js">moviemasher.js</a> |
<a
href="https://github.com/moviemasher/angular-moviemasher">angular-moviemasher</a>
| moviemasher.rb</strong></p>

<p><em>Ruby library for mashing up video, images and audio utilizing FFmpeg
and Ecasound</em></p>

<h1 id="label-moviemasher.rb">moviemasher.rb<span><a href="#label-moviemasher.rb">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Use moviemasher.rb to encode mashups of video, audio, and images from a
JSON formatted job description. A job specifies multiple media inputs to be
encoded together into one or more outputs, as well as where to find the
inputs and where to place the outputs.</p>
<ul><li>
<p><strong>concatenate</strong> files together sequentially with trimming</p>
</li><li>
<p><strong>mix</strong> audio tracks together with variable fading</p>
</li><li>
<p><strong>composite</strong> visual tracks together with transformations</p>
</li><li>
<p><strong>add</strong> titling as an effect or theme with custom fonts</p>
</li><li>
<p><strong>transfer</strong> encoded files to remote hosts</p>
</li><li>
<p><strong>specify</strong> callbacks that alert your system of processing
milestones</p>
</li></ul>

<p>The project aims to take the complexity out of describing common
audio/video editing operations to command line programs, which handle the
low level transcoding operations. The <a
href="MovieMasher.html">MovieMasher</a> class turns your job into a series
of commands and then manages their execution.</p>

<p>As part of job processing it can download media inputs from remote hosts
and upload media outputs as well. Using the same mechanisms it can also
trigger callbacks as a job is started, during its processing and when
it&#39;s completed so that external systems can be alerted.</p>

<p>The project includes a rake task that can be routinely called to watch a
folder for job description files, as well as an example crontab entry that
calls it. Recall that ruby scripts run from cron lack your user&#39;s
environmental variables, so you&#39;ll probably need to edit the paths to
binary directories in the entry to match your system.</p>

<h3 id="label-AWS+Integration">AWS Integration<span><a href="#label-AWS+Integration">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>There are optional configuration settings that support two specific Amazon
Web Services offerings: S3 for media storage and SQS for job queueing. If
set to use an SQS queue then it will be polled as part of the folder
watching process for job files. The ruby aws-sdk is utilized to interface
with SQS, so access key details can be provided in the configuration or
environmental variables or in a role if deployed on an EC2 instance.</p>

<p>Similarly, aws-sdk is utilized for S3 interactions so if access key details
are present then buckets can be used either as sources for media inputs or
destinations for media outputs within job descriptions. These are
authenticated requests, so the buckets do not have to be public.</p>

<p>Additionally, the Movie Masher AMI is available in Marketplace and includes
moviemasher.rb and all supporting applications. When launched it looks for
user data supplied in JSON format and merges it into the default
configuration, so it&#39;s possible to supply SQS options on startup. The
cron job described above is installed, so a configured SQS queue will
immediately start being polled for jobs. Otherwise the instance will start
up apache to serve the angular-moviemasher project, preconfigured to
utilize the local moviemasher.rb process (the instance id acts as a shared
password).</p>

<h3 id="label-Basic+Usage">Basic Usage<span><a href="#label-Basic+Usage">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<pre class="ruby">    <span class="ruby-identifier">require_relative</span> <span class="ruby-string">&#39;lib/moviemasher.rb&#39;</span>
    <span class="ruby-identifier">job</span> = { :<span class="ruby-identifier">inputs</span> =<span class="ruby-operator">&gt;</span> [], :<span class="ruby-identifier">base_source</span> =<span class="ruby-operator">&gt;</span> {}, :<span class="ruby-identifier">outputs</span> =<span class="ruby-operator">&gt;</span> [], :<span class="ruby-identifier">destination</span> =<span class="ruby-operator">&gt;</span> {} }
    <span class="ruby-identifier">job</span>[:<span class="ruby-identifier">base_source</span>][:<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">job</span>[:<span class="ruby-identifier">destination</span>][:<span class="ruby-identifier">path</span>] = <span class="ruby-string">&#39;~/&#39;</span>
    <span class="ruby-identifier">job</span>[:<span class="ruby-identifier">inputs</span>] <span class="ruby-operator">&lt;&lt;</span> { :<span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;video&#39;</span>, :<span class="ruby-identifier">source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;input.mov&#39;</span>, :<span class="ruby-identifier">fill</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;crop&#39;</span> }
    <span class="ruby-identifier">job</span>[:<span class="ruby-identifier">inputs</span>] <span class="ruby-operator">&lt;&lt;</span> { :<span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;image&#39;</span>, :<span class="ruby-identifier">source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;input.jpg&#39;</span>, :<span class="ruby-identifier">length</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> }
    <span class="ruby-identifier">job</span>[:<span class="ruby-identifier">inputs</span>] <span class="ruby-operator">&lt;&lt;</span> { :<span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;audio&#39;</span>, :<span class="ruby-identifier">source</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;input.mp3&#39;</span>, :<span class="ruby-identifier">offset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }
    <span class="ruby-identifier">job</span>[:<span class="ruby-identifier">outputs</span>] <span class="ruby-operator">&lt;&lt;</span> { :<span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;video&#39;</span>, :<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;output.mp4&#39;</span> }
    <span class="ruby-constant">MovieMasher</span>.<span class="ruby-identifier">process</span> <span class="ruby-identifier">job</span>
</pre>

<p>When inputs use relative URLs like the example above then either the input
or the job needs a <code>base_source</code> object to resolve them to
absolute ones. Likewise, a <code>destination</code> object resolves the
location of outputs and can be placed either in them or in the job in order
to be available to all outputs. We&#39;ve set them both to our home
directory in this case so all files live there.</p>

<p>Inputs are arranged consecutively one after the other - at least the visual
ones. Audio inputs will by default start where the last audio or video with
audio ends, so if the video input in our example has audio the audio input
will start after it, otherwise they will begin at the same time. You can
also explicitly play an audio track at any time by specify its
<code>start</code> value.</p>

<p>In addition to raw media (video, audio and images) it&#39;s also possible
to output image sequences from video tracks and waveform graphics from
audio tracks. In terms of inputs, it&#39;s also possible to provide a mash
JSON payload like moviemasher.js creates. Within a mash input, visual
elements can be composited together just like audio elements can in the job
itself.</p>

<p>The visual composition of inputs is controlled by <em>effect, scaler</em>
and <em>merger</em> media, which are all arrangements of FFmpeg
<em>filters</em>. Only a subset of filters and their parameters are
supported at this time, but they include basics like crop, scale, fade and
drawtext. That last one relies on <em>font</em> media, the last of the
modular types.</p>

<h3 id="label-How+to+Install">How to Install<span><a href="#label-How+to+Install">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ol><li>
<p>install ffmpeg, ecasound, sox and du programs</p>
</li><li>
<p>install ruby and builder</p>
</li><li>
<p><code>bundle install</code> in project directory installs required gems
from Gemfile</p>
</li><li>
<p>edit config/config.yml configuration file to match paths on system and
configure logging/debugging options</p>
</li><li>
<p><code>rake moviemasher:process_queues</code> searches watch folder and
optional SQS queue for jobs</p>
</li><li>
<p>optionally install calling crontab entry found at config/moviemasher.cron
after checking binary paths in it</p>
</li></ol>

<h3 id="label-Requirements">Requirements<span><a href="#label-Requirements">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>ffmpeg with ffprobe</p>
</li><li>
<p>ecasound</p>
</li><li>
<p>sox</p>
</li><li>
<p>du</p>
</li><li>
<p>builder gem</p>
</li><li>
<p>require_all gem</p>
</li><li>
<p>json gem</p>
</li><li>
<p>uuid gem</p>
</li><li>
<p>mime-types gem</p>
</li><li>
<p>multipart-post gem</p>
</li><li>
<p>rake gem</p>
</li><li>
<p>rack gem</p>
</li><li>
<p>aws-sdk gem</p>
</li></ul>

<h3 id="label-Developer+Setup">Developer Setup<span><a href="#label-Developer+Setup">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ol><li>
<p>uncomment entries in Gemfile related to spec tests</p>
</li><li>
<p><code>bundle install</code> from project directory installs additional gems</p>
</li><li>
<p><code>rspec spec</code> will run the core tests</p>
</li><li>
<p>The following with regenerate the doc directory:
 rdoc --visibility=public
--main=&#39;README.md&#39; -o doc --fmt=darkfish --markup=tomdoc
--tab-width=2 --no-dcov --exclude=&#39;/spec&#39; --exclude=&#39;/log/&#39;
--exclude=&#39;/Gemfile&#39; --exclude=&#39;/config/&#39;
--exclude=&#39;/index.rb&#39; --exclude=&#39;/doc/&#39;
--exclude=&#39;/Rakefile&#39;</p>
</li></ol>

<h5 id="label-To+run+tests+in+spec_aws">To run tests in spec_aws<span><a href="#label-To+run+tests+in+spec_aws">&para;</a> <a href="#documentation">&uarr;</a></span></h5>
<ol><li>
<p>install and launch clientside_aws</p>
</li><li>
<p>uncomment other entries in Gemfile</p>
</li><li>
<p><code>bundle install</code> from project directory installs additional gems</p>
</li></ol>

<h5 id="label-Known+issues+in+Version+4.0.08">Known issues in Version 4.0.08<span><a href="#label-Known+issues+in+Version+4.0.08">&para;</a> <a href="#documentation">&uarr;</a></span></h5>
<ul><li>
<p>local/sqs import/export has not been thoroughly tested</p>
</li><li>
<p>archiving of outputs not yet supported</p>
</li><li>
<p>freeze frame not yet supported</p>
</li><li>
<p>audio still being done in Ecasound</p>
</li><li>
<p>due to size considerations, video files not included in spec tests
(eventually tests will generate their own to work with)</p>
</li></ul>

<h5 id="label-Migrating+from+Version+4.0.07">Migrating from Version 4.0.07<span><a href="#label-Migrating+from+Version+4.0.07">&para;</a> <a href="#documentation">&uarr;</a></span></h5>
<ul><li>
<p>The <code>length</code> key in clips has been renamed <code>frames</code>.</p>
</li><li>
<p>The <code>audio</code> and <code>video</code> keys in mash tracks have been
moved to mash.</p>
</li><li>
<p>The <code>tracks</code> key in mashes has been removed.</p>
</li><li>
<p>The <code>fps</code> key in outputs has been renamed
<code>video_rate</code>.</p>
</li><li>
<p>The <code>audio_frequency</code> key in outputs has been renamed
<code>audio_rate</code>.</p>
</li><li>
<p>The <code>trim</code> key in inputs has been renamed <code>offset</code>.</p>
</li></ul>
</div>


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 4.0.0.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

